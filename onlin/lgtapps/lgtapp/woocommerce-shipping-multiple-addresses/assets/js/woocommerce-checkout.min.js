var last_id="",_multi_shipping=!1,_ms_reloaded=!1;function supports_html5_storage(){try{$supports_html5_storage="sessionStorage"in window&&null!==window.sessionStorage,window.sessionStorage.setItem("mship","test"),window.sessionStorage.removeItem("mship")}catch(e){$supports_html5_storage=!1}return $supports_html5_storage}function wcms_resize_thickbox(){jQuery(window).width()<400&&(jQuery(document).find("#TB_window").css({width:"300px",marginLeft:"-"+parseInt(150,10)+"px"}),jQuery(document).find("#TB_ajaxContent").css("width","auto"))}function wcms_checkout_button_logic(){var e,t;WCMS.not_eligible_wcms||(WCMS.has_item_address||WCMS.has_cart_address?(t=jQuery("#customer_details .col-2"),jQuery("#shiptobilling").hide(),jQuery(".woocommerce-shipping-fields").find("#shiptobilling-checkbox").attr("checked",!0).hide(),jQuery(".woocommerce-shipping-fields").find("#ship-to-different-address-checkbox").attr("checked",!1).hide(),jQuery(".woocommerce-shipping-fields").find("h3#ship-to-different-address").hide(),jQuery(".woocommerce-shipping-fields").prepend('<h3 id="ship-to-multiple">'+WCMS.modify_title_text+"</h3>"),jQuery(".woocommerce-shipping-fields").find(".shipping_address").remove(),e=WCMS.has_item_address?WCMS.modify_addr_link:WCMS.add_addr_link,jQuery('<p><a href="'+e+'" class="button button-primary">'+WCMS.modify_addr_text+'</a> <a href="'+WCMS.reset_url+'" class="button button-primary">'+WCMS.reset_addr_text+"</a></p>").insertAfter("#customer_details .col-2 h3:first")):WCMS.no_multi_address&&(t=jQuery("#customer_details .col-2"),jQuery(t).find("#shiptobilling-checkbox").attr("checked",!0).hide(),jQuery("#wcms_set_addresses").on("click",function(e){e.preventDefault();var t=WCMS.ajaxurl,e=jQuery(".woocommerce-billing-fields"),e={action:"wcms_ajax_save_billing_fields",security:WCMS.save_nonce,billing_first_name:e.find("#billing_first_name").val(),billing_last_name:e.find("#billing_last_name").val(),billing_company:e.find("#billing_company").val(),billing_country:e.find("#billing_country").val(),billing_address_1:e.find("#billing_address_1").val(),billing_address_2:e.find("#billing_address_2").val(),billing_city:e.find("#billing_city").val(),billing_state:e.find("#billing_state").val(),billing_postcode:e.find("#billing_postcode").val(),billing_phone:e.find("#billing_phone").val(),billing_email:e.find("#billing_email").val()};jQuery.ajax({method:"POST",url:t,data:e,success:function(e){"success"===e.result?window.location=WCMS.modify_addr_link:alert(e.message)}})})))}jQuery(document).ready(function(c){var i,a;function e(e){if(-1==c.inArray(e.getDay(),WCMS.datepicker_valid_days))return[!1];var t=e.getMonth()+1+"-"+e.getDate()+"-"+e.getFullYear(),e=WCMS.datepicker_excluded_dates.map(function(e){return e.replace(/(^|-)0+/g,"$1")});return-1!=c.inArray(t,e)?[!1]:[!0]}supports_html5_storage()&&(i={},a={},c("form.checkout").on("blur",".woocommerce-billing-fields :input",function(){var e=c(this).attr("id"),t=c(this).val();i[e]=t,localStorage.setItem("wcms_billing_fields",JSON.stringify(i))}),c("form.checkout").on("blur",".woocommerce-shipping-fields :input",function(){var e=c(this).attr("id"),t=c(this).val();a[e]=t,localStorage.setItem("wcms_shipping_fields",JSON.stringify(a))}),c("form.checkout :input").trigger("blur")),c("a.ms_delete_address").click(function(e){e.preventDefault();var e=c(this).data("idx"),t=c(this).parents(".address-block");c(t).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),c.post(WCMS.ajaxurl,{action:"wc_ms_delete_address",idx:e,_wcmsnonce:WCMS._wcmsnonce},function(e){c(t).unblock(),c(t).remove()})}),c("select.shipping_methods").on("change",function(){c("body").trigger("update_checkout")}),c("[name=shipping_method]").on("change",function(){"local_pickup"==c(this).val()||"local_pickup_plus"==c(this).val()?c("#wcms_message").hide():1==c("#wcms_message").data("allowed")&&c("#wcms_message").show()}).change(),c("body").on("updated_checkout",function(){_multi_shipping&&(c("tr.shipping").remove(),_ms_reloaded||(c("body").trigger("update_checkout"),_ms_reloaded=!0),c(".ms_shipping_date").datepicker({beforeShowDay:e,minDate:0}),c(".ms_shipping_date").attr("readOnly","true"))}),c(".user-duplicate-cart").click(function(e){e.preventDefault(),tb_show("Shipping Address","#TB_inline?height=520&width=400&inlineId=duplicate_address_form_template"),wcms_resize_thickbox()}),c(".address-use").click(function(){var e=JSON.parse(c(this).parents("p").prev("textarea").val());c(this).prop("disabled",!0),c(".add-address").click(),setAddress(e,last_id)}),c("#cart_items ul li").draggable({appendTo:"body",helper:"clone",revert:!1,cursorAt:{left:50,top:30}}),c("li.address-item > a.remove").on("click",function(e){e.preventDefault();var t=c(this).parents("li.address-item"),i=c(t).parents(".items-column"),a=parseInt(c(t).find(".qty").text()),s=c(t).data("key"),d=c(t).data("product-id");0<c("#"+s).length?(e=parseInt(c("#"+s).find(".qty").text())+a,c("#"+s).data("quantity",e).find(".qty").text(e)):(d=c("<li></li>").html(c(t).html()).data("quantity",a).data("product-id",d).attr("class",c(t).attr("class").replace(/(address\-item)/gi,"cart-item")).attr("id",c(t).data("key")),c(d).find("a.remove").remove(),c(d).find("input").remove(),c(d).appendTo("ul.cart-items"),c(d).draggable({appendTo:"body",helper:"clone",revert:!1,cursorAt:{left:0,top:0}})),c(t).remove(),0==c(i).children("li").length&&c(i).append('<li class="placeholder">Drag items here</li>'),c("#addresses_container").masonry("reload")}),c("#address_form").submit(function(){if(0<c(".cart-items li").length)return alert("Please assign a shipping address for all your cart items."),!1}),c(".items-column").droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",tolerance:"pointer",drop:function(e,t){var i=c(t.draggable).data("quantity"),a=1;if(1<i){if(null==(a=prompt("Enter the quantity (1-"+i+"):","1")))return!1;a<1&&(a=1),i<(a=Math.floor(a))&&(a=i)}c(this).find(".placeholder").remove(),i-=a;var s=c(t.draggable).attr("id"),d=c(t.draggable).data("product-id"),n=c(".address-item-key-"+s,this).length,r=c(this).attr("id").split("_")[2];if(c(t.draggable).data("quantity",i),c(".qty",t.draggable).text(i),0==n){for(var n=c(t.draggable).attr("class").replace(/(cart\-item)/gi,"address-item"),o=c("<li></li>").attr("class",n).addClass("address-item-key-"+s).data("key",s).data("product-id",d).html(t.draggable.html()).appendTo(this),l=0;l<a;l++)c(o).append('<input type="hidden" name="items_'+r+'[]" value="'+s+'" />');c(o).append('<a class="remove" href="#"><img style="width: 16px; height: 16px;" src="'+WCMS.base_url+'/assets/images/delete.png" title="Remove" /></a>').find(".qty").text(a),c(o).find("div.quantity").remove()}else{d=parseInt(c(".address-item-key-"+s,this).find(".qty").text());c(".address-item-key-"+s,this).find(".qty").text(d+a);for(l=0;l<a;l++)c(".address-item-key-"+s,this).append('<input type="hidden" name="items_'+r+'[]" value="'+s+'" />')}0==i&&c(t.draggable).remove(),jQuery("#addresses_container").masonry("reload")}});var t=WCMS.countries.replace(/&quot;/g,'"'),l=JSON.parse(t);jQuery("select.country_to_state").on("change",function(){var a=c(this).val(),s=c(this).closest("div").find('select[id^="address[shipping_state]"], input[id^="address[shipping_state]"]'),d=s.parent(),n=s.attr("name"),r=s.attr("id"),o=s.val();l[a]?0==l[a].length?d.fadeOut(200,function(){s.parent().find(".chzn-container").remove(),s.replaceWith('<input type="hidden" class="hidden" name="'+n+'" id="'+r+'" value="" />'),c("body").trigger("country_to_state_changed",[a,c(this).closest("div")])}):d.fadeOut(200,function(){var e,t="",i=l[a];for(e in i)t=t+'<option value="'+e+'">'+i[e]+"</option>";s.is("input")&&(s.replaceWith('<select name="'+n+'" id="'+r+'" class="state_select"></select>'),s=c(this).closest("div").find('select[id^="address[shipping_state]"], input[id^="address[shipping_state]"]')),s.html('<option value="">'+WCMS.select_state_text+"</option>"+t),s.val(o),c("body").trigger("country_to_state_changed",[a,c(this).closest("div")]),d.fadeIn(500)}):s.is("select")?d.fadeOut(200,function(){d.find(".chzn-container").remove(),s.replaceWith('<input type="text" class="input-text" name="'+n+'" id="'+r+'" />'),c("body").trigger("country_to_state_changed",[a,c(this).closest("div")]),d.fadeIn(500)}):s.is(".hidden")&&(d.find(".chzn-container").remove(),s.replaceWith('<input type="text" class="input-text" name="'+n+'" id="'+r+'" />'),c("body").trigger("country_to_state_changed",[a,c(this).closest("div")]),d.delay(200).fadeIn(500)),c("body").delay(200).trigger("country_to_state_changing",[a,c(this).closest("div")])}).change(),c("#ms_addresses").change(function(){var e=c("#ms_addresses option:selected"),t=e.data(),i="";if(""!=e.val()){for(var a in t)"shipping_"==a.substr(0,9)&&("shipping_state"==a?i=t[a]:(c(".woocommerce-shipping-fields #"+a).length&&c(".woocommerce-shipping-fields #"+a).val(t[a]).change(),c(".wcms-address-form .shipping_address #"+a).length&&c(".wcms-address-form .shipping_address #"+a).val(t[a]).change()));c("body").one("country_to_state_changed",function(){c(".woocommerce-shipping-fields #shipping_state").val(i).change(),c(".wcms-address-form .shipping_address #shipping_state").val(i).change()}),c(".woocommerce-shipping-fields #shipping_country, .wcms-address-form .shipping_address #shipping_country").change()}}).change(),c("#addresses_container").length&&c("#addresses_container").masonry({itemSelector:".account-address",isFitWidth:!0}),Modernizr&&Modernizr.touch&&(c("li.cart-item").on("click",function(){c(this).hasClass("cart-item-active")?(c(this).removeClass("cart-item-active"),c("#addresses_container .account-address").removeClass("drop-ready")):(c(this).addClass("cart-item-active"),c("#addresses_container .account-address").addClass("drop-ready"))}),c(".items-column").on("click",function(){var o=this;c("li.cart-item-active").each(function(){var e=this,t=c(e).data("quantity");c(o).find(".placeholder").remove(),--t;var i=c(e).attr("id"),a=c(e).data("product-id"),s=c(".address-item-key-"+i,o).length,d=c(o).attr("id").split("_")[2];if(c(e).data("quantity",t),c(".qty",e).text(t),0==s){var s=c(e).attr("class").replace(/(cart\-item)/gi,"address-item"),n=c("<li></li>").attr("class",s).addClass("address-item-key-"+i).data("key",i).data("product-id",a).html(c(e).html());c(o).append(n);for(var r=0;r<1;r++)c(n).append('<input type="hidden" name="items_'+d+'[]" value="'+i+'" />');c(n).append('<a class="remove" href="#"><img style="width: 16px; height: 16px;" src="'+WCMS.base_url+'/assets/images/delete.png" title="Remove" /></a>').find(".qty").text(1),c(n).find("div.quantity").remove()}else{a=parseInt(c(".address-item-key-"+i,o).find(".qty").text());c(".address-item-key-"+i,o).find(".qty").text(a+1);for(r=0;r<1;r++)c(".address-item-key-"+i,o).append('<input type="hidden" name="items_'+d+'[]" value="'+i+'" />')}0==t&&c(e).remove(),jQuery("#addresses_container").masonry("reload")})})),c(".delete-line-item").on("click",function(){var e=c(this).data("key"),t=c(this).data("index");c("#delete_index").val(t),c("#delete_key").val(e)}),wcms_checkout_button_logic()}),jQuery(window).resize(function(){wcms_resize_thickbox()});
